plugins {
    id 'org.jetbrains.kotlin.multiplatform'
    id 'kotlinx-serialization'
    id 'com.codingfeline.kgql'
}

apply from: '../../../../gradle/dependencies.gradle'

repositories {
    maven {
        url "file://${projectDir.absolutePath}/../../../../build/localMaven"
    }
    mavenCentral()
    maven { url 'https://dl.bintray.com/kotlin/kotlinx' }
    maven { url 'https://dl.bintray.com/kotlin/kotlin-eap' }
}

kgql {
    packageName = "com.sample"
    typeMapper = [
            "UserProfile": "com.sample.data.UserProfile"
    ]

    schemaEndpoint = "https://api.github.com/graphql"
    schemaHeaders = [
            "Authorization": "bearer develop"
    ]
}

kotlin {
    jvm()
    js()
    iosArm64() {
        binaries {
            framework()
        }
    }
    iosX64() {
        binaries {
            framework()
        }
    }

    sourceSets {
        commonMain {
            dependencies {
                implementation deps.kotlin.stdlib.common
                implementation deps.kotlin.serialization.common
            }
        }
        jvmMain {
            dependencies {
                implementation deps.kotlin.stdlib.jdk7
                implementation deps.kotlin.serialization.jvm
            }
        }
        jsMain {
            dependencies {
                implementation deps.kotlin.stdlib.js
                implementation deps.kotlin.serialization.js
            }
        }
        nativeMain {
            dependencies {
                implementation deps.kotlin.serialization.native
            }
        }
        nativeTest {}

        [iosX64(), iosArm64()].forEach { t ->
            t.compilations.main.source(sourceSets.nativeMain)
            t.compilations.test.source(sourceSets.nativeTest)
        }
    }
}
